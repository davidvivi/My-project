<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__PUBLIC__/admin/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/admin/lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/admin/lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/admin/lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/admin/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/admin/lib/layer/1.9.3/layer.js"></script> 
<script type="text/javascript" src="__PUBLIC__/admin/lib/My97DatePicker/WdatePicker.js"></script> 
<script type="text/javascript" src="__PUBLIC__/admin/lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/admin/lib/webuploader/0.1.5/webuploader.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/admin/lib/Validform/5.3.2/Validform.min.js"></script>  
<script type="text/javascript" src="__PUBLIC__/admin/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/admin/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__PUBLIC__/admin/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" src="__PUBLIC__/admin/js/H-ui.js"></script> 
<script type="text/javascript" src="__PUBLIC__/admin/js/H-ui.admin.js"></script> 
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>商品添加</title>
</head>
<body>
<div class="pd-20">
	<form action="" enctype="multipart/form-data" method="post" class="form form-horizontal" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-2"><span class="c-red">*</span>商品名称：</label>
			<div class="formControls col-6">
				<input type="text" class="input-text" value="" placeholder="" id="goodname" name="name">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-2">
				<span class="c-red">*</span>分类栏目：
			</label>
			<div class="formControls col-10"> 
				
					<select name="cate_1" id="cate" class="select" style="width:25%;">
						<option value="-1">--请选择一级分类--</option>
						<foreach name="catelist_1" item="vo">
							<option value="{$vo.id}">{$vo.name}</option>
						</foreach>
				
					</select>
					<select name="cate_2" id="cate2" class="select" style="width:25%;">
						<option value="-1">--请选择二级分类--</option>
						<foreach name="catelist_2" item="vo">
							<option value="{$vo.id}">|-{$vo.name}</option>
						</foreach>
					</select>
					<select name="cate_3" id="cate3" class="select" style="width:25%;">
						<option value="-1">--请选择三级分类--</option>
						<foreach name="catelist_3" item="vo">
							<option value="{$vo.id}">|-|-{$vo.name}</option>
						</foreach>
					</select>
					
				 
			</div>
			
		</div>
		
		<div class="row cl">
			<label class="form-label col-2">产品展示价格：</label>
			<div class="formControls col-4">
				<input type="text" name="price" id="price" placeholder="" value="" class="input-text" style="width:90%">
				元</div>
			
		</div>
		
		<div class="row cl">
			<label class="form-label col-2">库存：</label>
			<div class="formControls col-2">
				<input type="text" name="store" id="store" placeholder="" value="" class="input-text" style="width:90%">
			</div>
			<label class="form-label col-2">浏览量：</label>
			<div class="formControls col-2">
				<input type="text" name="view" id="view" placeholder="" value="0" class="input-text" style="width:90%">
			</div>
			<label class="form-label col-2">购买量：</label>
			<div class="formControls col-2">
				<input type="text" name="buy" id="buy" placeholder="" value="0" class="input-text" style="width:90%">
			</div>
				
		</div>
		
		
		
		<div class="row cl">
			<label class="form-label col-2">产品关键字：</label>
			<div class="formControls col-10">
				<input type="text" name="keyword" id="keyword" placeholder="多个关键字用英文逗号隔开，限10个关键字" value="" class="input-text">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-2">商品描述：</label>
			<div class="formControls col-10">
				<textarea name="desc" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="textarealength(this,200)"></textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		
		
		<div class="row cl">
			<label class="form-label col-2">添加图片：</label>
			<div class="formControls col-10"> 
				<div class="tab-pane" id="tab_goods_images">
					<table class="table table-bordered">
						<tbody>
						<tr>                                    
							<td>   
								<foreach name="goodsImages" item="vo" key="k" >
									<div style="width:100px; text-align:center; margin: 5px; display:inline-block;" class="goods_xc">
										<input type="hidden" value="{$vo['image_url']}" name="goods_images[]">
										<a onclick="" href="{$vo['image_url']}" target="_blank"><img width="100" height="100" src="{$vo['image_url']}"></a>
										<br>
										<a href="javascript:void(0)" onclick="ClearPicArr2(this,'{$vo['imgage_url']}')">删除</a>
									</div>
								</foreach>
																
								<div class="goods_xc" style="width:100px; text-align:center; margin: 5px; display:inline-block;">
									<input type="hidden" name="goods_images[]" value="" />
									<a id="picpic" href="javascript:void(0);"><img src="__PUBLIC__/admin/images/add-button.jpg" width="100" height="100" /></a>
									<br/>
									<a href="javascript:void(0)">&nbsp;&nbsp;</a>
								</div>                                        
							</td>
						</tr>                                              
						</tbody>
					</table>
				</div>
			</div>
		</div>
		
		<button id="sub" class="btn btn-danger radius" style="margin-top:40px;margin-left:350px;">
			确认提交
		</button>
		
		
	</form>
</div>

<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
	
	//分类下拉框
	/*
	$('#cate').change(function(){
		val = $(this).val();
		
		$.ajax({
			type:'post',
			url:'__URL__/add',
			data:'val='+val,
			success:function(data){
				
			}
		})
		
	});
	*/
	
	//ajax提交
	$('#sub').click(function(){
		
		$.ajax({
			type:'post',
			url:'__URL__/goodsAdd',
			data:$('#form-article-add').serialize(),
			success:function(data){
				if(data == 1){
					$('#addpic').css('display','block');
				}
			}
		})
	});
	
	/*
     * 以下是图片上传方法
     */
 
    // 上传商品图片成功回调函数
    function call_back(fileurl_tmp){
        $("#original_img").val(fileurl_tmp);
    	$("#original_img2").attr('href', fileurl_tmp);
    }
 
    // 上传商品相册回调函数
    function call_back2(paths){
        
        var  last_div = $(".goods_xc:last").prop("outerHTML");	
        for (i=0;i<paths.length ;i++ )
        {                    
            $(".goods_xc:eq(0)").before(last_div);	// 插入一个 新图片
                $(".goods_xc:eq(0)").find('a:eq(0)').attr('href',paths[i]).attr('onclick','').attr('target', "_blank");// 修改他的链接地址
            $(".goods_xc:eq(0)").find('img').attr('src',paths[i]);// 修改他的图片路径
                $(".goods_xc:eq(0)").find('a:eq(1)').attr('onclick',"ClearPicArr2(this,'"+paths[i]+"')").text('删除');
            $(".goods_xc:eq(0)").find('input').val(paths[i]); // 设置隐藏域 要提交的值
        } 			   
    }
    /*
     * 上传之后删除组图input     
     * @access   public
     * @val      string  删除的图片input
     */
    function ClearPicArr2(obj,path)
    {
    	$.ajax({
                    type:'GET',
                    url:"{:U('Admin/Uploadify/delupload')}",
                    data:{action:"del", filename:path},
                    success:function(){
                                  $(obj).parent().remove(); // 删除完服务器的, 再删除 html上的图片				 
                    }
		});
    }
	$('#picpic').on('click',function(){
		GetUploadify(10,'','goods','call_back2');
		}
	);
	
	function GetUploadify(num,input,path,func){
		url = '__MODULE__/uploadify/upload?num='+num+'&input='+input+'&path='+path+'&func='+func;
		layer.open({
			type: 2,
			title: '添加图片',
			shadeClose: true,
			shade: 0.8,
			area: ['500px', '90%'],
			content: url //iframe的url
		}); 
	}
	

	
});	

</script>
</body>
</html>